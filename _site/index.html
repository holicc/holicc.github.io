<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1" name="viewport">
        <link rel="stylesheet" href="/assets/css/main.css">

        <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Joe | nothing</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Joe" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="nothing" />
<meta property="og:description" content="nothing" />
<link rel="canonical" href="http://localhost:4000/" />
<meta property="og:url" content="http://localhost:4000/" />
<meta property="og:site_name" content="Joe" />
<link rel="next" href="http://localhost:4000/page2" />
<script type="application/ld+json">
{"url":"http://localhost:4000/","headline":"Joe","name":"Joe","description":"nothing","@type":"WebSite","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    </head>

    <body style="background-color: rgba(220, 238, 203, 0.781)">
        <script async src="/assets/js/theme.min.js"></script>

        <header>
            
        </header>

        <main>
            <article>
                <h1 class="headline">Joe</h1>

<div class="article-list">
  
  <h2><a href="/2020/02/01/Java-Resizable-Array.html">ã€è¯‘ã€‘Javaå®ç°å¤§å°å¯å˜çš„æ•°ç»„ </a></h2>
  <small>February 01, 2020</small>
  <p>Javaå®ç°å¤§å°å¯å˜çš„æ•°ç»„


  æœ‰æ—¶ä¸ºäº†å¿«é€Ÿçš„è®¿é—®æ•°æ®ï¼ˆç‰¹åˆ«æ˜¯byteç±»å‹ï¼‰ï¼Œéœ€è¦å°†æ•°æ®æ”¾å…¥ä¸€ä¸ªå•ç‹¬ä¸”è¿ç»­çš„æ•°ç»„ä¸­ï¼Œä¸”æ•°ç»„è‡³å°‘æ˜¯èƒ½å¤Ÿå¯æ‰©å¼ çš„ã€‚ç”±äºJavaä¸­çš„æ•°ç»„æ˜¯ä¸èƒ½å¤Ÿæ”¹å˜å…¶å¤§å°çš„ï¼Œæ‰€ä»¥ä½¿ç”¨æ•°ç»„æœ¬èº«æ˜¯ä¸èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚çš„ã€‚å› æ­¤ï¼Œä¸ºäº†èƒ½å¤Ÿå®¹çº³åŸç”Ÿç±»å‹å¹¶ä¸”å¯æ”¹å˜å…¶å¤§å°çš„æ•°ç»„ï¼Œéœ€è¦è‡ªå·±åŠ¨æ‰‹å®ç°ã€‚


ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ArrayListï¼Ÿ

æœ‰äººå¯èƒ½ä¼šæƒ³åˆ°ä½¿ç”¨ArrayListæ¥å®ç°åˆšæ‰è¯´çš„éœ€æ±‚ã€‚å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œå‰ææ˜¯æ»¡è¶³ä»¥ä¸‹ä»»æ„æ¡ä»¶ï¼š

  æ•°ç»„ä¸­å­˜å‚¨çš„ç±»å‹æ˜¯å¯¹è±¡ç±»å‹ã€‚
  æ•°ç»„ä¸­å­˜å‚¨çš„æ˜¯åŸç”Ÿç±»å‹ï¼Œä¸”ä¸å…³å¿ƒæ€§èƒ½å’Œå†…å­˜ã€‚


Javaä¸­çš„ArrayListç±»åªèƒ½å­˜å‚¨å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œä¸é€‚ç”¨äºåŸç”Ÿç±»å‹ï¼ˆä¾‹å¦‚byteï¼Œintï¼Œlongç­‰ï¼‰ã€‚å¦‚æœæ˜¯ä½¿ç”¨äº†ArrayListå­˜å‚¨åŸç”Ÿç±»å‹è¿™äº›æ•°æ®å°±ä¼šå˜è‡ªåŠ¨çš„è£…ç®±ä¸ºå¯¹åº”å¯¹è±¡å­˜å…¥ArrayListä¸­ï¼Œå¹¶ä¼šåœ¨ä½¿ç”¨çš„æ—¶å€™è‡ªåŠ¨æ‹†ç®±ä¸ºåŸç”Ÿç±»å‹ã€‚ç”±äºæ¶‰åŠåˆ°äº†æ‹†ç®±å’Œè£…ç®±æœºåˆ¶ï¼Œå½“ä½ æƒ³è¦ä¼˜åŒ–æå‡æ€§èƒ½çš„æ—¶å€™ArrayListä¸æ˜¯ä½ æƒ³çš„ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œå­˜å‚¨è£…ç®±åçš„åŸç”Ÿç±»å‹ä¼šå¸¦æ¥é¢å¤–çš„å†…å­˜è´Ÿæ‹…ã€‚

å®ç°ä»£ç  - GitHub Repository

æœ¬æ•™ç¨‹çš„å®ç°ä»£ç æ”¾ç½®äºGitHubæ–¹ä¾¿è®¿é—®ï¼šï¼‰

https://github.com/jjenkov/java-resizable-array

ä»£ç ç”±3ä¸ªJavaç±»å’Œ2ä¸ªå•å…ƒæµ‹è¯•ç»„æˆ

å¯å˜å¤§å°çš„æ•°ç»„ä½¿ç”¨åœºæ™¯

æƒ³æƒ³ä½ æœ‰ä¸€ä¸ªæœåŠ¡æ­£åœ¨æ¥å—å„ç§å¤§å°ä¸åŒçš„æ¶ˆæ¯ã€‚æœ‰ä¸€äº›æ¶ˆæ¯å¤§å°å¾ˆå°ï¼ˆä¾‹å¦‚å°äº4kbï¼‰ï¼Œå…¶ä»–åˆ™æ˜¯ä¸€äº›1mbå·¦å³çš„æˆ–è€…æ›´å¤§çš„æ¶ˆæ¯æ•°æ®ã€‚å¦‚æœæœåŠ¡ç«¯ä¸çŸ¥é“å°†è¦æ¥æ”¶çš„æ•°æ®å¤§å°ï¼Œå°±ä¸èƒ½ä¸ºå°†è¦æ¥æ”¶çš„æ¶ˆæ¯é¢„å…ˆåˆ†é…å¥½å†…å­˜ç©ºé—´ã€‚ä»£æ›¿æ–¹å¼æ˜¯â€œè¶…é¢åˆ†é…â€ï¼Œæ„æ€æ˜¯åˆ†é…ä¸€å—è¶³å¤Ÿå¤§çš„å†…å­˜ç©ºé—´æ¥æ¥æ”¶æ¶ˆæ¯ï¼ˆæœ€å¤§æ¶ˆæ¯ä¸è¶…è¿‡5mbï¼Œé‚£ä¹ˆæ¯ä¸ªæ¶ˆæ¯å—åˆ™åˆ†é…6mbçš„å†…å­˜ï¼‰ã€‚

å¦‚æœæœåŠ¡ç«¯åŒä¸€æ—¶é—´æ­£ä»å¤šä¸ªé“¾æ¥ï¼ˆ100K+ï¼‰ä¸­æ¥æ”¶æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¿…é¡»é™åˆ¶æ¯ä¸€æ¡æ¶ˆæ¯æ‰€éœ€è¦åˆ†é…çš„å†…å­˜å¤§å°ã€‚ä¸èƒ½ç›´æ¥æŒ‰ç…§æœ€å¤§æ¶ˆæ¯å¤§å°ï¼ˆä¾‹å¦‚ 1mbæˆ–16mbï¼‰æ¥ç»™æ¯ä¸€æ¡æ¶ˆæ¯åˆ†é…å†…å­˜ã€‚è¿™æ ·éšç€è¿æ¥æ•°å’Œæ¥æ”¶æ¶ˆæ¯æ•°çš„å¢åŠ ï¼Œå¾ˆå¿«å°±ä¼šè€—å°½æœåŠ¡å™¨å†…å­˜ï¼100.000 x 1MB = 100GB (å¤§æ¦‚å¯ä»¥æƒ³è±¡ä¸€ä¸‹).

æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ¥æ”¶æ¶ˆæ¯å‰å°½å¯èƒ½çš„åˆ†é…å°çš„bufferï¼Œå½“å°bufferä¸è¶³ä»¥æ¥æ”¶å¤§æ¶ˆæ¯æ•°æ®æ˜¯æˆ‘ä»¬å°±éœ€è¦æ‰©å®¹è¿™ä¸ªbufferã€‚

æ•°ç»„çš„æ‰©å®¹ä»£ä»·é«˜æ˜‚

ä¸ºäº†æ‰©å®¹ä¸€ä¸ªæ•°ç»„ä½ éœ€è¦ï¼š

1.åˆ†é…ä¸€ä¸ªæ–°çš„æ›´å¤§çš„æ•°ç»„ã€‚

2.å°†æ—§æ•°ç»„çš„æ•°æ®æ‹·è´åˆ°æ–°æ•°ç»„ä¸­ã€‚

3.å›æ”¶æ—§æ•°ç»„ã€‚

è¿™ä¸€äº›åˆ—çš„æ“ä½œä»£ä»·é«˜æ˜‚ï¼ˆç‰¹åˆ«æ˜¯æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨ï¼‰ï¼ç‰¹åˆ«æ˜¯éšç€æ—§æ•°ç»„æ•°æ®è¶Šå¤šæ‹·è´æ•°æ®åˆ°æ–°æ•°ç»„è¿™ä¸ªæ“ä½œçš„ä»£ä»·å°±è¶Šå¤§ã€‚

æ³¨æ„ï¼Œåœ¨ä¸€äº›å¸¦æœ‰åƒåœ¾å›æ”¶æœºåˆ¶çš„è¯­è¨€ä¸­ï¼ˆä¾‹å¦‚Javaï¼ŒC#ç­‰ï¼‰å°½ç®¡ä½ æ²¡æœ‰æ˜ç¡®æŒ‡ä»¤å›æ”¶æ—§æ•°ç»„ï¼Œè™šæ‹Ÿæœºä¹Ÿä¼šä¸ºä½ æ‰§è¡Œæ­¤æ“ä½œï¼Œæ‰€ä»¥è¿Ÿæ—©éƒ½éœ€è¦ä»˜æ¸…å›æ”¶æ“ä½œçš„ä»£ä»·ã€‚

æœ€å°æ•°ç»„çš„æ‰©å®¹

ä¸ºäº†å°†æŸå¤±é™ä½åˆ°æœ€ä½ï¼Œä½ éœ€è¦å°½å¯èƒ½å‡å°‘æ•°ç»„æ‰©å®¹çš„æ¬¡æ•°ï¼Œå°½é‡åˆ›å»ºä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ•°ç»„æ¥ä¿å­˜å…¨éƒ¨çš„æ¶ˆæ¯æ•°æ®ã€‚

å¦‚æœæˆ‘ä»¬æ¥æ”¶çš„å¤§éƒ¨åˆ†æ¶ˆæ¯éƒ½æ˜¯å°æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨å°bufferæ¥æ¥æ”¶ã€‚å¦‚æœæ¶ˆæ¯å¤§å°è¶…è¿‡æ¥å°bufferçš„å¤§å°ï¼Œæˆ‘ä»¬å°±åˆ†é…ä¸€ä¸ªæ–°çš„ä¸­ç­‰å¤§å°çš„æ•°ç»„å¹¶ä¸”å°†æ—§æ•°ç»„ä¸­çš„æ•°æ®æ‹·è´åˆ°æ–°åˆ†é…çš„æ•°ç»„ä¸­ã€‚åŒæ ·å½“æ¶ˆæ¯å¤§å°è¶…è¿‡äº†ä¸­ç­‰å¤§å°çš„bufferï¼Œå°±åˆ›å»ºä¸€ä¸ªæ›´å¤§çš„æ•°ç»„å¹¶æ‹·è´è¿‡å»ã€‚è¿™ä¸ªå¤§çš„æ•°ç»„éœ€è¦è¶³å¤Ÿå¤§ï¼Œå¤§åˆ°èƒ½å¤Ÿå®¹çº³ä¸€æ•´ä¸ªæ¶ˆæ¯æ•°æ®ã€‚å¦‚æœæ¶ˆæ¯çš„å¤§å°å¤ªå¤§ä»¥è‡³äºä¸èƒ½å¤Ÿå¤„ç†ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å°±åº”è¯¥æ‹’ç»æ¥æ”¶è¯¥æ¶ˆæ¯ã€‚

é‡‡ç”¨è¿™æ ·çš„ç­–ç•¥ï¼Œå¤§éƒ¨åˆ†çš„æ¶ˆæ¯åªä¼šå ç”¨è¾ƒå°çš„bufferã€‚è¿™æ ·æœ‰åˆ©äºæœåŠ¡å™¨å†…å­˜çš„ä½¿ç”¨ã€‚100.000 x 4KB (å°çš„buffer) åªéœ€è¦400MBã€‚å¤§éƒ¨åˆ†çš„æœåŠ¡å™¨éƒ½èƒ½å¤Ÿæ‰¿å—ã€‚
å³ä½¿æ˜¯4GBï¼ˆ1.000.000 x 4KBï¼‰ç°ä»£çš„æœåŠ¡å™¨ä¹Ÿæ˜¯å¯ä»¥æ”¯æ’‘çš„ã€‚

å¯æ‰©å®¹æ•°ç»„è®¾è®¡

å¯æ‰©å®¹æ•°ç»„æœ‰ä¸¤ä¸ªç»„ä»¶ç»„æˆï¼š


  ResizableArray
  ResizableArrayBuffer


ResizableArrayBufferåŒ…å«ä¸€ä¸ªå•ä¸€çš„ï¼Œå¤§æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸ºäº†å­˜å‚¨å°çš„æ•°ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸ºäº†å­˜å‚¨è¾ƒå¤§çš„æ•°ç»„ï¼Œæœ€åä¸€ä¸ªæ˜¯å­˜å‚¨å¤§æ•°ç»„ã€‚

ResizableArrayä»£è¡¨äº†ä¸€ä¸ªå•ä¸€çš„ï¼Œå¯æ‰©å®¹çš„æ•°ç»„ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®å­˜å‚¨ä¸è¿™ä¸ªæ•°ç»„ä¸­çš„ResizableArrayBufferé‡Œã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªå›¾æ¥è§£é‡ŠResizableArrayBufferä¸­çš„ä¸‰éƒ¨åˆ†æ˜¯å¦‚ä½•åˆ’åˆ†çš„ã€‚



æ•´ä¸ªResizableArrayBufferçš„å¤§æ•°ç»„ä¸­ä¿ç•™ä¸€ä¸ªæ•°æ®å¤§å°çš„é—´éš™(small, medium, large)ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æ¯ä¸ªæ•°æ®å—éƒ½ä¸ä¼šè¢«å®Œå…¨å……æ»¡ã€‚ä¾‹å¦‚ï¼Œæ¥æ”¶çš„smallæ•°æ®å—ä¸èƒ½å æ»¡mediumå’Œlargeçš„å†…å­˜åŒºå—ã€‚åŒæ ·çš„largeæ•°æ®å—ä¸èƒ½å æ»¡smallå’Œmediumçš„å†…å­˜åŒºå—ã€‚

åˆšå¼€å§‹çš„æ—¶å€™æ¶ˆæ¯å—éƒ½æ˜¯ä»smallæ•°æ®å—å¼€å§‹å¡«å……çš„ï¼Œå¦‚æœsmallæ•°ç»„å—è¢«ç”¨å°½ï¼Œé‚£ä¹ˆå°†ä¸ä¼šåˆ†é…æ–°çš„æ•°ç»„å—äº†ï¼Œä¸ç®¡meidumå—å’Œlargeå—æ˜¯å¦è¿˜æœ‰å‰©ä½™çš„ç©ºé—´ã€‚

ç„¶è€Œï¼Œå­˜åœ¨ä¸€ç§å¾ˆå°çš„å¯èƒ½æ˜¯smallæ•°ç»„å—å æ®äº†æ•´ä¸ªæ•°ç»„å—çš„å¤§éƒ¨åˆ†ç©ºé—´ã€‚

å³ä½¿smallæ•°ç»„å—å·²ç»è¢«ä½¿ç”¨å®Œäº†ï¼Œä¹Ÿå­˜åœ¨ä¸€ç§å¯èƒ½å°†smallæ¶ˆæ¯å—çš„æ•°æ®å¢é•¿ä¸ºmediumå’Œlargeçš„æ¶ˆæ¯å—ã€‚

ä¼˜åŒ–é€‰é¡¹

ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„æ•°ç»„å—æ¥ä¼˜åŒ–æ•´ä¸ªæ•°ç»„ã€‚å› ä¸ºæœ‰æ—¶ä¸€ä¸ªæ–°çš„æ•°ç»„å—è¢«åˆ†é…åç«‹é©¬å°±éœ€è¦è¢«æ‰©å®¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ä½ ä¸éœ€è¦å°†æ—§æ•°æ®æ‹·è´åˆ°æ–°çš„æ•°ç»„å—ä¸­ã€‚ä½ åªéœ€è¦ç®€å•çš„â€œæ‰©å±•â€è¿™ä¸ªæ•°ç»„å—ä½¿å…¶åŒ…å«ä¸¤ä¸ªæ•°ç»„å—ä¸€ä¸ªæ—§çš„æ•°ç»„å—ä¸€ä¸ªæ–°çš„æ•°ç»„å—ï¼Œå¹¶å°†æ–°çš„æ•°æ®å†™å…¥æ–°çš„æ•°ç»„å—ä¸­ã€‚è¿™æ ·å½“ä¸€ä¸ªå†…å­˜å—éœ€è¦è¢«â€œæ‰©å±•â€åˆ°ä¸‹ä¸€ä¸ªè¿ç»­çš„å—ä¸­æ—¶å°±èŠ‚çº¦äº†æ•°ç»„æ‹·è´çš„æˆæœ¬ã€‚

ä¸Šè¿°æ–¹æ¡ˆå­˜åœ¨çš„ç¼ºç‚¹æ˜¯ï¼Œå½“ä¸å¯èƒ½å°†æ•°ç»„å—æ‰©å±•åˆ°ä¸‹ä¸€ä¸ªå†…å­˜å—ä¸­ï¼Œæ‹·è´æ•°æ®ä»»ç„¶æ˜¯å¿…é¡»çš„ã€‚å› æ­¤éœ€è¦è¿›è¡Œä¸€æ¬¡æ˜¯å¦å¯æ‰©å±•çš„æ£€æŸ¥æ“ä½œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ä¸€ä¸ªsmallæ•°ç»„å—ï¼Œé‚£ä¹ˆæ‹“å±•æ“ä½œå°†ä¼šæ¯”ä½¿ç”¨mediumå’Œlargeæ•°ç»„å—æ›´åŠ é¢‘ç¹ã€‚

ä¿æŒè·Ÿè¸ªå’Œå›æ”¶æ•°æ®å—

ResizableArrayBufferä¸­çš„å¤§æ•°ç»„è¢«åˆ†ä¸ºä¸‰éƒ¨åˆ†ã€‚æ¯ä¸€éƒ¨åˆ†åˆè¢«åˆ†ä¸ºä¸€ä¸ªæ›´å°çš„å—ã€‚æ¯ä¸ªå—åœ¨æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯åŒæ ·çš„å¤§å°ã€‚ä¾‹å¦‚ï¼Œåœ¨smalléƒ¨åˆ†ä¸­çš„æ‰€æœ‰æ•°æ®å—éƒ½æ˜¯smallå¤§å°çš„æ•°æ®å—ï¼Œåœ¨meiduméƒ¨åˆ†éƒ½æ˜¯meidumå¤§å°çš„æ•°æ®å—ã€‚åœ¨largeéƒ¨åˆ†ä¹Ÿæ˜¯åŒç†ã€‚

å½“åœ¨ä¸€ä¸ªéƒ¨åˆ†çš„æ‰€æœ‰å—éƒ½æ˜¯åŒæ ·å¤§å°æ—¶ï¼Œæ‰èƒ½æ›´åŠ å®¹æ˜“ä¿æŒè·Ÿè¸ªä½¿ç”¨è¿‡çš„å—å’Œæ²¡ä½¿ç”¨çš„å—çš„æƒ…å†µã€‚ä½ å¯ä»¥ç®€å•çš„å°†æ¯ä¸€ä¸ªå—æ‰€åœ¨çš„ç´¢å¼•ä½ç½®ä¿å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚æ¯ä¸ªéƒ¨åˆ†éƒ½éœ€è¦ä¸€ä¸ªè¿™æ ·çš„é˜Ÿåˆ—ã€‚æœ€ç»ˆï¼Œéœ€è¦ä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜è·Ÿè¸ªsmallå—çš„ä½¿ç”¨æƒ…å†µï¼Œä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜meidumå—çš„ä½¿ç”¨æƒ…å†µï¼Œä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜largeå—çš„ä½¿ç”¨æƒ…å†µã€‚

ä»ä»»ä½•ä¸€ä¸ªéƒ¨åˆ†åˆ†é…ä¸€ä¸ªå—çš„æ“ä½œå°±å¯ä»¥ç®€å•çš„ç­‰ä»·äºä»å¯¹åº”éƒ¨åˆ†çš„é˜Ÿåˆ—ä¸­æ‹¿èµ°ç©ºé—²å—çš„æ‰€åœ¨çš„ç´¢å¼•ã€‚å›æ”¶ä¸€ä¸ªå—çš„æ“ä½œå°±å¯ä»¥çœ‹ä½œæ”¾ç½®ä¸€ä¸ªç´¢å¼•åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚

æ‰©å®¹å¹¶å†™å…¥æ•°æ®

å¯æ‰©å®¹çš„æ•°ç»„å›è‡ªè¡Œæ‰§è¡Œæ‰©å®¹æ“ä½œåœ¨ä½ å†™å…¥æ•°æ®çš„æ—¶å€™ã€‚å¦‚æœä½ å°è¯•å†™å…¥æ¯”æ•°ç»„å½“å‰åˆ†é…çš„å—æ›´å¤šçš„æ•°æ®æ—¶ï¼Œæ•°ç»„å°±ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„æ›´å¤§çš„å—å¹¶æ‹·è´å†™å…¥çš„æ•°æ®åˆ°è¿™ä¸ªæ–°çš„å—ä¸­ã€‚ä¹‹å‰çš„é‚£ä¸ªå°çš„æ•°æ®å—å°±ä¼šè¢«é‡Šæ”¾å›æ”¶ã€‚

é‡Šæ”¾æ•°ç»„å—

ä¸€æ—¦ä½ ä½¿ç”¨å®Œäº†ä¸€ä¸ªå¯æ‰©å®¹çš„æ•°ç»„ï¼Œä½ åº”è¯¥å†æ¬¡é‡Šæ”¾å®ƒï¼Œè¿™æ ·å°±å¯ä»¥ç”¨äºå­˜å‚¨å…¶ä»–çš„æ¶ˆæ¯æ•°æ®äº†ã€‚

å¦‚ä½•ä½¿ç”¨ResizableArrayBuffer

å±•ç¤ºå¦‚ä½•ä½¿ç”¨ä¸€ä¸ªResizableArrayBufferï¼ˆä»£ç æ¥è‡ªGitHubï¼‰ã€‚

åˆ›å»ºä¸€ä¸ª

é¦–å…ˆä½ éœ€è¦åˆ›å»ºä¸€ä¸ªResizableArrayBufferã€‚

int smallBlockSize  =    4 * 1024;
int mediumBlockSize =  128 * 1024;
int largeBlockSize  = 1024 * 1024;

int smallBlockCount  = 1024;
int mediumBlockCount =   32;
int largeBlockCount  =    4;

ResizableArrayBuffer arrayBuffer =
        new ResizableArrayBuffer(
                smallBlockSize , smallBlockCount,
                mediumBlockSize, mediumBlockCount,
                largeBlockSize,  largeBlockCount);


è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸€ä¸ªå«æœ‰4kbçš„smallæ•°ç»„å—ï¼Œ128kbçš„meidumæ•°ç»„å—ï¼Œ1mbçš„largeæ•°ç»„å— ResizableArrayBuffer ï¼Œå¹¶ä¸”åŒ…å«1024ä¸ªsmallæ•°ç»„å—ï¼ˆä¸€å…±å¯å­˜å‚¨4mbçš„æ•°æ®ï¼‰ï¼Œ32ä¸ªmediumæ•°ç»„å—ï¼ˆä¹Ÿæ˜¯å…±4mbï¼‰å’Œ4ä¸ªlargeæ•°ç»„å—ï¼ˆå…±4mbï¼‰ï¼Œæ•´ä¸ªæ•°ç»„å¯å­˜å‚¨12mbçš„æ•°æ®ã€‚

è·å–ä¸€ä¸ªResizableArrayå®ä¾‹

é€šè¿‡è°ƒç”¨ ResizableArrayBufferçš„ getArray()æ–¹æ³•ã€‚

ResizableArray resizableArray = arrayBuffer.getArray();


è¿™æ ·è·å–åˆ°ä¸€ä¸ªæœ€å°å¤§å°çš„ResizableArrayçš„å®ä¾‹ï¼ˆé¢„å…ˆåˆ†é…å®¹é‡ä¸º4kbï¼‰ã€‚

ResizableArrayä¸­å†™å…¥æ•°æ®

é€šè¿‡è°ƒç”¨ ResizableArrayçš„ write()æ–¹æ³•å†™å…¥æ•°æ®ã€‚ResizableArrayç±»åªåŒ…å«ä¸€ä¸ªwrite()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ª ByteBufferä½œä¸ºå‚æ•°ã€‚

ByteBuffer byteBuffer = ByteBuffer.allocate(1024);

for(int i=0; i &lt; 1024; i++){
    byteBuffer.put((byte) i);
}
byteBuffer.flip():

int bytesCopied = resizableArray.write(byteBuffer);


ä¸Šè¿°ä»£ç å°† ByteBuffer æ‹·è´åˆ° ResizableArrayçš„æ•°ç»„å—ä¸­ã€‚write()æ–¹æ³•çš„è¿”å›å€¼ä¸ºä» ByteBuffer ä¸­æ‹·è´bytesçš„æ•°é‡ã€‚

ä¸ºäº†é˜²æ­¢ ByteBufferä¸­çš„æ•°æ®é‡å¤§äºå½“å‰ResizableArrayåˆ†é…çš„å¤§å°ï¼ŒResizableArrayä¼šå°è¯•æ‰©å®¹æ¥å®¹çº³ ByteBufferä¸­çš„æ•°æ®ã€‚å¦‚æœResizableArrayå·²ç»æ‰©å®¹çš„åˆ°æœ€å¤§ä¸”æ— æ³•è£…ä¸‹ ByteBufferä¸­çš„æ•°æ®æ—¶ï¼Œwrite()æ–¹æ³•å°±ä¼šè¿”å›-1ï¼ŒByteBufferä¸­çš„æ•°æ®è‡ªç„¶ä¹Ÿä¸ä¼šæ‹·è´åˆ°ResizableArrayä¸­ã€‚

ResizableArrayè¯»å–æ•°æ®

å½“ä»ResizableArrayä¸­è¯»å–æ•°æ®æ—¶ç›¸å½“äºç›´æ¥ä»ResizableArrayä¸­çš„æ•°ç»„ä¸­ç›´æ¥è¯»å–ã€‚ResizableArrayç±»ä¸­åŒ…å«å…¬å¼€çš„å±æ€§æœ‰ï¼š

public byte[] sharedArray = null;
public int    offset      = 0;
public int    capacity    = 0;
public int    length      = 0;


sharedArrayå±æ€§æŒæœ‰æ‰€æœ‰ResizableArrayå®ä¾‹çš„æ•°æ®çš„æ•°ç»„çš„å¼•ç”¨ã€‚è¿™æ ·çš„æ•°ç»„ä¹Ÿå­˜åœ¨äºResizableArrayBufferä¸­ã€‚

offsetå±æ€§ä¿å­˜çš„ResizableArrayçš„æ•°æ®å—èµ·å§‹ä½ç½®çš„ç´¢å¼•ã€‚

capacityå±æ€§è¡¨ç¤ºResizableArrayæ•°æ®å—çš„å¤§å°ã€‚

lengthå±æ€§è¡¨ç¤ºResizableArrayå®é™…ä½¿ç”¨çš„æ•°æ®å—æ•°é‡ã€‚

ä»ResizableArrayä¸­è¯»å–æ•°æ®ç›¸å½“äºè¯»å– sharedArray[offset] åˆ° sharedArray[offset + length - 1] æ®µçš„æ•°æ®ã€‚

é‡Šæ”¾ResizableArray

ä¸€æ—¦ä½¿ç”¨å®Œäº†ResizableArrayï¼Œå°±éœ€è¦è°ƒç”¨ free()æ–¹æ³•æ¥é‡Šæ”¾æ•°ç»„ã€‚

resizableArray.free();


è°ƒç”¨åä¼šå½’è¿˜æ‰€å ç”¨çš„æ•°æ®å—åˆ°å¯¹åº”çš„æ•°æ®å—é˜Ÿåˆ—ä¸­ï¼Œä¸è®ºæ•°æ®å—åˆ†é…çš„æ˜¯å¤šå¤§çš„å¤§å°ã€‚

æ€»ç»“

è·ŸJavaä¸­ArrayListå®ç°æ–¹å¼æœ‰ç‚¹ç±»ä¼¼ã€‚ä¸ºäº†æå‡æ€§èƒ½å°½é‡è¦ä½¿ç”¨åŸç”Ÿæ•°æ®ç±»å‹ï¼Œæ—¶åˆ»æ³¨æ„æ•°æ®çš„å›æ”¶åˆ©ç”¨ã€‚

å¼•ç”¨

1.resizable-array
</p>
  
  <h2><a href="/2019/12/04/Learning-HTTP-Protocol.html">HTTP Note - 01 </a></h2>
  <small>December 04, 2019</small>
  <p>TCPè¿æ¥ç›¸å…³


  å¹¶è¡Œè¿æ¥ï¼šä¼šæ¶ˆè€—æ›´å¤šçš„èµ„æºï¼ˆæ¯”å¦‚å†…å­˜ï¼‰ï¼Œä¹Ÿä¼šå—åˆ°å¸¦å®½çš„é™åˆ¶ï¼Œæ‰“å¼€è¿æ¥æ•°é‡æœ‰é™ï¼Œä¼šå—åˆ°TCPæ…¢å¯åŠ¨å’Œæ‹¥å¡é€‚åº”çš„å½±å“ã€‚æ‰€ä»¥ä¹Ÿä¸ä¸€å®šå¿«ã€‚ç”¨æˆ·ä½“éªŒä¸Šä¼šæ„Ÿè§‰å¿«äº†ã€‚
  æŒä¹…è¿æ¥ï¼šåœ¨ä¸€ä¸ªHTTPäº‹åŠ¡å®Œæˆä¹‹åä¸å…³é—­è¿æ¥ï¼Œç›´åˆ°æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯é€šçŸ¥å…³é—­è¿æ¥ï¼Œå¯ä»¥é¿å…TCPæ…¢å¯åŠ¨ï¼Œè¿›å…¥å·²è°ƒåçŠ¶æ€ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ã€‚HTTP/1.0 ä½¿ç”¨çš„æ˜¯ Connectionï¼škeep-aliveå…³é”®å­—è¿›è¡Œæ ‡è®°æ˜¯å¦ä¿æŒè¿æ¥ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ã€‚HTTP/1.1 é»˜è®¤å¼€å¯äº†æŒä¹…è¿æ¥ï¼Œå¦‚æœåœ¨é¦–éƒ¨æ²¡æ³•æ ‡è®°ï¼šConnectionï¼šcloseå°±é»˜è®¤ä¸ºå¼€å¯æŒä¹…è¿æ¥ã€‚
  ä»£ç†å¯¹äºHTTPæŠ¥æ–‡çš„æŸäº›å­—æ®µå¹¶ä¸ä¼šè½¬å‘ï¼ˆæ¯”å¦‚Connectionå­—æ®µç­‰ï¼‰
  ç®¡é“åŒ–è¿æ¥ï¼šåœ¨HTTP/1.1çš„æŒä¹…è¿æ¥çš„åŸºç¡€ä¸Šå¼€é€šç®¡é“ï¼Œå°†å¤šæ¡è¯·æ±‚çªœè¡Œå‘é€ã€‚å¿…é¡»ä¿è¯æœ‰åºçš„åº”ç­”ï¼Œå¤±è´¥é‡è¯•æœºåˆ¶å¯èƒ½æ— æ³•é€‚ç”¨äºPOSTè¿™æ ·çš„éå¹‚ç­‰è¯·æ±‚ã€‚
  TCPæ˜¯åŒå‘è¿æ¥ï¼ˆè¾“å…¥å’Œè¾“å‡ºï¼‰ï¼Œå½“è¾“å…¥ç«¯è¢«å…³é—­ç„¶è€Œæ•°æ®å¹¶æ²¡æœ‰ä¼ è¾“å®Œï¼Œå°±ä¼šå—åˆ°æ“ä½œç³»ç»Ÿçš„å¼‚å¸¸æç¤ºâ€œè¿æ¥å·²ç»è¢«å……å€¼â€ï¼ˆéš¾æ€ªä¹‹å‰åšDHTçš„æ—¶å€™è€æ˜¯é‡åˆ°è¿™ä¸ªreset exception) å…³é—­è¾“å…¥é€šé“æ¯”è¾ƒå±é™©ï¼Œå…³é—­è¾“å‡ºç›¸å¯¹å®‰å…¨


ä»£ç†


  è¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªä½¿ç”¨ç›¸åŒåè®®çš„åº”ç”¨ç¨‹åº
  é€šè¿‡ä»£ç†èµ·åˆ°æµé‡ç›‘æ§ã€è®¿é—®æ§åˆ¶ã€ç¼“å­˜ã€æœåŠ¡å™¨åŠ é€Ÿï¼ˆåå‘ä»£ç†ï¼‰
  é€šè¿‡å°†ä»£ç†æœåŠ¡å™¨éƒ¨ç½²åœ¨ç½‘ç»œç»“æ„ä¸­çš„ä¸åŒä½ç½®æ¥å®ç°ä¸åŒçš„åŠŸèƒ½ ï¼ˆå¯ä»¥è‡ªå·±å®ç°æµé‡ç›‘æ§æˆ–è€…åŒ¿ååŠŸèƒ½ï¼Ÿï¼‰


å¦‚ä½•è®©æµé‡æµå‘ä»£ç†æœåŠ¡å™¨ï¼Ÿï¼ˆåŸºäºå¦‚ä½•è·å–HTTPçš„æµé‡ä¿¡æ¯ï¼‰


  ä¿®æ”¹å®¢æˆ·ç«¯
  ä¿®æ”¹ç½‘ç»œ ï¼ˆå¾ˆé»‘å®¢ï¼‰
  ä¿®æ”¹DNSçš„å‘½åç©ºé—´ ï¼ˆå¾ˆé»‘å®¢ï¼‰
  ä¿®æ”¹WebæœåŠ¡å™¨


HTTP/1.1å­˜åœ¨çš„é—®é¢˜


  å¤æ‚æ€§ï¼Œå®ç°éš¾åº¦è¾ƒå¤§
  å¯æ‹“å±•æ€§ï¼Œåè®®æ‹“å±•æ²¡æœ‰å…¼å®¹æ€§
  æ€§èƒ½
  ä¼ è¾“åè®®çš„ä¾èµ–ï¼Œä¾èµ–äºTCP/IPç½‘ç»œåè®®æ ˆ


ä¸ºäº†è§£å†³ä»¥ä¸Šçš„é—®é¢˜ï¼Œæˆäº†1997å¹´HTTP-NGç»„ï¼Œç„¶è€Œåœ¨ä¸€å¹´ä¹‹åå°±è§£æ•£äº†ï¼ˆç”±äºå½“æ—¶HTTP/1.1è¿˜æ²¡æœ‰æ™®åŠï¼Œæ‰€ä»¥æš‚æ—¶åœæ­¢äº†é‡æ„HTTPåè®®ï¼Œå†åæ¥HTTP/2.0å°±æ¥äº†ï¼‰

å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€

å‘¨æ‰€å‘¨çŸ¥HTTPæ˜¯æ— çŠ¶æ€çš„ï¼Œé‚£ä¹ˆæ—©æœŸçš„å¤§ä½¬ä»¬æ˜¯å¦‚ä½•ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€çš„å‘¢ï¼Ÿ


  èƒ–URLï¼šé€šè¿‡å°†ç”¨æˆ·ç™»å½•åç”Ÿäº§çš„ä¸ºIDå¸¦åˆ°æ¯ä¸€ä¸ªURLä¸­æ ‡ç¤ºç”¨æˆ·ã€‚ç„¶è€Œè¿™ä¸ªæ–¹æ³•é—®é¢˜å¤šåˆ°ğŸ’¥ã€‚
  CookieæŠ€æœ¯ï¼šç”±ç½‘æ™¯å…¬å¸å¼€å‘çš„æŠ€æœ¯ï¼Œä¸€è‡´æ²¿ç”¨è‡³ä»Šã€‚Cookieçš„åŸºæœ¬æ€æƒ³æ˜¯è®©æµè§ˆå™¨ç´¯ç§¯ä¸€ç»„æœåŠ¡å™¨ç‰¹æœ‰çš„çš„ä¿¡æ¯ï¼Œæ¯æ¬¡éƒ½å°†è¿™äº›ä¿¡æ¯å¸¦ä¸Šè®¿é—®æœåŠ¡å™¨ã€‚Cookieæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼š0å’Œ1ã€‚ç°åœ¨å¤§è§„æ¨¡ä½¿ç”¨çš„éƒ½æ˜¯ç”±ç½‘æ™¯å…¬å¸åˆ¶å®šçš„ç‰ˆæœ¬0ï¼ˆå› ä¸º1ç‰ˆæœ¬å¤ªå¤æ‚äº†å§ï¼‰


é—®é¢˜


  ä»€ä¹ˆæ˜¯å¹‚ç­‰ï¼Ÿï¼ˆç­”ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡ï¼Œä¸ç®¡æ‰§è¡Œå¤šå°‘æ¬¡ç»“æœéƒ½æ˜¯ç›¸ç­‰çš„ï¼Œè¿™ä¸ªäº‹åŠ¡å°±æ˜¯å¹‚ç­‰çš„ã€‚ï¼‰
  ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿï¼ˆç­”ï¼šHTTPä¸­æŒ‡çš„æ˜¯ä¸€æ¬¡HTTPè¯·æ±‚çš„å®Œæ•´æµç¨‹ã€‚ï¼‰


æ€»ç»“

é˜…è¯»å®Œã€ŠHTTPæƒå¨æŒ‡å—ã€‹ï¼Œå…±è€—æ—¶5ï½6ä¸ªå°æ—¶ï¼Œè¯¥ä¹¦æ˜¯åŸºäºHTTP/1.1ç‰ˆæœ¬è¿›è¡Œè®²è§£çš„ï¼ˆç°åœ¨å·²ç»æœ‰HTTP/2.0ç‰ˆæœ¬ï¼‰å¾ˆå¤šå·²ç»è¿‡æ—¶æˆ–è€…å†…å®¹ä¸HTTPæ²¡æœ‰å¤ªå¤šå…³è”çš„ç« èŠ‚éƒ½è·³è¿‡äº†ã€‚è¿™ä¸ªä¹¦æ˜¯ä¸€ä¸ªHTTPåè®®çš„å¤§è‡´ä»‹ç»ï¼Œè®²è§£çš„å†…å®¹ä¸æ˜¯å¾ˆç»†ï¼Œè¿˜æœ‰å¾ˆå¤šå†…å®¹éƒ½æ˜¯è¿‡æ—¶çš„å†…å®¹ï¼ˆæ¯•ç«Ÿå‡ºç‰ˆæ¯”è¾ƒä¹…äº†ï¼‰ã€‚ç”±äºå†…å®¹æ¯”è¾ƒç®€å•ç¬”è®°ä¹Ÿåšçš„ä¸å¤šã€‚æ€»çš„æ¥è¯´è®©æˆ‘å¯¹HTTPåè®®æœ‰äº†åŸºæœ¬çš„è®¤è¯†å’Œäº†è§£ï¼Œäº†è§£äº†HTTPåè®®çš„ä¸€ä¸ªè¿›åŒ–è¿‡ç¨‹ï¼Œé€šè¿‡ä»HTTP/0.9åˆ°HTTP/1.1çš„è¿™ä¸ªè¿‡ç¨‹é‡åˆ°å¾ˆå¤šwebå¼€å‘ä¸­æ¯”è¾ƒå¸¸è§çš„é—®é¢˜ï¼ˆæ¯”å¦‚ä»£ç†ã€ç¼“å­˜ã€DNSè§£æã€è®¤è¯æœºåˆ¶ç­‰ï¼‰ã€‚ä¹Ÿå¼•å‡ºäº†TCP/IPçš„é‡è¦æ€§ï¼Œæ¯•ç«ŸHTTPæ˜¯å±äºåº”ç”¨å±‚çš„åè®®ï¼Œæ¶‰åŠåˆ°çš„å†…å®¹ä¸ä¼šå¤ªè¿‡äºå¤æ‚ï¼Œå¯¹äºTCPã€IPè¿™æ ·çš„åè®®å±äºä¼ è¾“å±‚æ›´åŠ é è¿‘åº•å±‚ä¼šå¤æ‚è®¸å¤šã€‚
</p>
  
  <h2><a href="/2019/10/26/Dependence-Injecting.html">Dependence Injecting </a></h2>
  <small>October 26, 2019</small>
  <p>What is Dependency injection

ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æŒ‡çš„é€šè¿‡ä¸€ä¸ªå¯¹è±¡ä¾èµ–å¦ä¸€ä¸ªå¯¹è±¡çš„ä¸€ç§æŠ€æœ¯æ–¹å¼ï¼Œä¾‹å¦‚åœ¨Clientå¯¹è±¡ä¸­ä¾èµ–ä¸€ä¸ªServiceç±»ï¼Œæˆ‘ä»¬æ‰€åšçš„æ–¹å¼ä¸æ˜¯åœ¨Clientå¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Serviceç±»æˆ–è€…å»å¯»æ‰¾ä¸€ä¸ªServiceç±»ï¼Œè€Œæ˜¯é€šè¿‡æŠŠServiceç±»å½“ä½œä¸ºClientå¯¹è±¡çš„ä¸€ä¸ªçŠ¶æ€æˆ–è€…è¯´ä¸€ä¸ªå±æ€§ä¼ é€’ç»™Clientå¯¹è±¡ã€‚

ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„æ„å›¾æ˜¯æƒ³å®ç°ç¨‹åºçš„è§£è—•ï¼ˆSoC Separation of Concernsï¼‰ï¼Œä¹Ÿæ˜¯è®¾è®¡æ¨¡å¼çš„ä¸€ç§ï¼Œè®©ç¨‹åºå˜æˆç›¸å¯¹ç‹¬ç«‹çš„éƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†å®Œæˆç‹¬ç«‹çš„åŠŸèƒ½ï¼Œä¿æŒåŠŸèƒ½å•ä¸€æ€§åŸåˆ™ã€‚è¿™æ ·èƒ½å¤Ÿæé«˜ä»£ç çš„é‡ç”¨æ€§ã€‚

ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å±äºIocï¼ˆInversion of Controlï¼‰æŠ€æœ¯ä¸­çš„ä¸€ç§ï¼Œä¸»è¦æ€æƒ³å°±æ˜¯å±è”½Clientå¯¹è±¡å¯¹å¦‚ä½•åˆ›å»ºServerè¿‡ç¨‹çš„æ„ŸçŸ¥ï¼ŒClientä¸éœ€è¦çŸ¥é“æ€ä¹ˆåˆ›å»ºServiceï¼Œç›¸åº”çš„æ³¨å…¥å®ç°ä¼šä»£æ›¿å®Œæˆè¿™é¡¹å·¥ä½œã€‚å°†æ„é€ Serviceçš„èƒ½åŠ›ä»Clientä¸­åˆ†ç¦»å‡ºæ¥ã€‚

ä¾èµ–æ³¨å…¥ä¸­å­˜åœ¨å››ç§è§’è‰²ï¼š


  è¢«ä¾èµ–çš„æœåŠ¡æä¾›è€…
  ä¾èµ–æœåŠ¡çš„å®¢æˆ·ç«¯
  æœåŠ¡æä¾›è€…çš„ç»Ÿä¸€æ¥å£
  åˆ›å»ºå’Œä¼ é€’æœåŠ¡çš„æ³¨å…¥è€…


ä½¿ç”¨è¿‡Springçš„å¼€å‘è€…ä¸€å®šå¾ˆç†Ÿæ‚‰çš„ã€‚

Javaç›¸å…³çš„ä¾èµ–æ³¨å…¥æ¡†æ¶CDIæœ‰å¾ˆå¤šï¼Œå°±æˆ‘æ‰€çŸ¥é“çš„æ¡†æ¶æœ‰ï¼š Weld æ–°æ¡†æ¶Quarkusçš„ä¾èµ–æ³¨å…¥å¥½åƒç”¨çš„å°±æ˜¯è¿™ä¸€ç§æ¡†æ¶, Springè€³ç†Ÿèƒ½è¯¦çš„Springå…¨å®¶æ¡¶ï¼Œè¿è¡Œæ—¶çš„ä¾èµ–æ³¨å…¥ï¼Œæ‰€ä»¥å¯åŠ¨çš„æ—¶å€™ä¼šå¾ˆæ…¢, Play frameworkscalaå†™çš„webæ¡†æ¶

Whatâ€™s the benift of DI

ç»¼ä¸Šæ‰€è¿°ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸‹é—®é¢˜ï¼š


  å¦‚ä½•ç‹¬ç«‹å‡ºåº”ç”¨æˆ–ç±»çš„åˆ›å»ºæ–¹å¼ï¼Ÿ
  å¦‚ä½•å¤ç”¨ä¸€ä¸ªå·²ç»åˆ›å»ºå¥½çš„ç±»ï¼Ÿ
  å¦‚ä½•åœ¨å•ç‹¬çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Ÿ
  åº”ç”¨ç¨‹åºå¦‚ä½•æ”¯æŒä¸åŒçš„é…ç½®ï¼Ÿ


ä»¥Springå¼€å‘ä¸ºä¾‹,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @Autowired æ³¨è§£å¾ˆå¿«çš„æ³¨å…¥ä¸€ä¸ªä¾èµ–çš„Serviceç±»

public class Client{

    @Autowried
    private ServiceA serviceA;

    public void do(){
        serviceA.doService();
    }
}


å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼æ˜¯å¦‚ä½•å®ç°å‘¢ï¼Ÿ
public class Client{

    private final ServiceA serviceA=new ServiceA();

    public void do(){
        serviceA.doService();
    }

}

çœ‹èµ·æ¥å¥½åƒä¹Ÿæ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œå°±æ˜¯ä½¿ç”¨new ServiceA()åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡è€Œå·²ã€‚ä½†æ˜¯å‡å¦‚åˆ›å»ºServiceAçš„æ–¹æ³•éœ€è¦æ›´å¤šçš„æ„é€ å‚æ•°å‘¢ï¼Ÿæ¯”å¦‚éœ€è¦Daoå±‚çš„æ”¯æŒï¼Œé‚£ä¹ˆä»£ç å°±ä¼šå˜æˆè¿™æ ·ï¼š
public class Client{

    private final UserRepository userRepository;
    private final ClientRepository clientRepository;

    private final ServiceA serviceA=new ServiceA(userRepository,clientRespository);
}

è¿™æ ·ä¸€æ¥Clientå°±ä¼šä¸ºäº†åˆ›å»ºServiceç±»å¼•å…¥æ›´å¤šä¸è‡ªèº«æ— å…³çš„ç±»ï¼Œè®©Clientå˜å¾—è‡ƒè‚¿ä¸å¥½ç»´æŠ¤ï¼Œå¦‚æœéœ€è¦åœ¨å¦ä¸€ä¸ªClientä¸­ä½¿ç”¨è¿™ä¸ªServiceé‚£ä¹ˆè¿˜å¾—å°†ä¸Šé¢ä»£ç æ‹·è´è¿‡å»ï¼Œåˆä¼šå¢åŠ é‡å¤ä»£ç çš„åå‘³é“ã€‚æˆ–åˆ™è¯´å½“Serviceç±»çš„æ„é€ æ–¹æ³•æ”¹å˜äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰ç”¨åˆ°å®ƒçš„Clientç±»éƒ½éœ€è¦ä¿®æ”¹ç›¸åº”çš„ä»£ç ã€‚

æ‰€æœ‰å¦‚æœä½¿ç”¨äº†ä¾èµ–æ³¨å…¥çš„æ–¹å¼å®ç°ä»£ç é€»è¾‘ä¼šæœ‰ä»¥ä¸‹å¥½å¤„ï¼š

  ä»£ç æ›´åŠ æ¸…æ™°æ˜æœ—ï¼Œå¢åŠ å¯è¯»æ€§ï¼Œå› ä¸ºä»£ç éƒ½ä¸€ä¸ªå•ç‹¬çš„åŠŸèƒ½
  Clientç±»å˜å¾—æ›´åŠ çµæ´»ï¼Œæœ‰é€‰æ‹©æ€§çš„ä¾èµ–éœ€è¦çš„Serviceç±»
  ä¾èµ–æ³¨å…¥éš”ç¦»ç±»Clientå’ŒServiceï¼Œä¸ä»…æé«˜äº†Serviceä»£ç çš„é‡ç”¨æ€§ï¼Œè¿˜è®©ä»£ç å¯ä»¥æ›´å¥½çš„è¿›è¡Œå•å…ƒæµ‹è¯•


å½“ç„¶æœ‰å¥½å¤„å°±æœ‰åå¤„çš„ï¼š

  ç”±äºåˆ›å»ºç±»çš„å·¥ä½œæ˜¯ä¸å¯è§çš„ï¼Œå„ä¸ªæ¡†æ¶ä¼šæœ‰ä¸åŒçš„å®ç°ç»†èŠ‚ã€‚
  å¼•å…¥é¢å¤–çš„ä¾èµ–ï¼Œè€Œä¸”ä¼šåˆ›å»ºå¾ˆå¤šç±»æˆ–æ¥å£ï¼ˆæ€»å¾—æœ‰ä¸ªCDIæ¡†æ¶å§ï¼ŒSpringæ‰“åŒ…å‡ºæ¥è¿˜æ˜¯æŒºå¤§çš„ï¼‰
  ä¼šå¢åŠ å¯åŠ¨æ—¶é—´ï¼ˆSpringå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼‰


DI in Spring

åœ¨æˆ‘çœ‹æ¥ï¼Œåœ¨Javaä¸­å®ç°DIä¸æ˜¯ä¸€ä»¶å›°éš¾çš„äº‹æƒ…ï¼Œä¸»è¦æ˜¯è€ƒè™‘å®ç°çš„DIä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ã€‚æ¯”å¦‚ä½¿ç”¨Springçš„DIï¼š

  Beanæ˜¯Singletonçš„
  å¯ä»¥æ£€æŸ¥åˆ°Cycle Dependence
  ä¿è¯æ¯æ¬¡è·å–çš„å®ä¾‹éƒ½æ˜¯æœ€æ–°çš„ï¼ˆä¾‹å¦‚åœ¨Controllerä¸­è·å–åˆ°çš„HttpSessionï¼‰


ä»¥ä¸Šæ˜¯ç›®å‰ä½¿ç”¨Springçš„æ—¶å€™èƒ½æƒ³åˆ°çš„å…³é”®ç‚¹ã€‚

åœ¨Springä¸­ä¾èµ–æ³¨å…¥çš„æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼š

  æ„é€ æ³¨å…¥ï¼Œé€šè¿‡åå°„å¹¶è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°è¿›è¡Œåˆ›å»ºå®ä¾‹ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯æ— å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚
  Setæ–¹æ³•æ³¨å…¥ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è°ƒç”¨Setæ–¹æ³•å°†éœ€è¦çš„å€¼æ³¨å…¥åˆ°ç±»ä¸­ã€‚
  æœ€å¸¸ç”¨çš„æ³¨è§£æ³¨å…¥ï¼Œä¸»è¦ä¾é çš„æ˜¯ JSR-250 @Resourceï½œ Spring @Autowired ï½œ JSR-330 @Inject  æ³¨è§£ã€‚


å®˜æ–¹æ–‡æ¡£ä¸­è¯´æ˜äº†@Autowiredé»˜è®¤ä½¿ç”¨çš„ByTypeè¿›è¡Œæ³¨å…¥ï¼Œ@Resourceé»˜è®¤ä½¿ç”¨çš„æ˜¯ByNameè¿›è¡Œæ³¨å…¥

//mapçš„keyåªèƒ½æ˜¯Stringä¼šè¢«æ³¨å…¥æˆBeançš„åå­—ï¼Œvalueæ˜¯èƒ½å¤Ÿç±»å‹åŒ¹é…ä¸Šçš„Beanå®ä¾‹
//è¿™æ ·å°±èƒ½åå»æ•´ä¸ªåº”ç”¨çš„æ‰€æœ‰Beanäº†
@Autowired
private Map&lt;String,Object&gt; maps;


æ„é€ æ³¨å…¥ä¸Setæ³¨å…¥çš„åŒºåˆ«ï¼š

  æ„é€ æ³¨å…¥æ˜¯å¼ºåˆ¶æ€§çš„ä¾èµ–ï¼Œsetæ–¹æ³•æ³¨å…¥æ˜¯é€‰æ‹©æ€§çš„ä¾èµ–ã€‚Spring teamæ¨èä½¿ç”¨çš„æ˜¯æ„é€ æ³¨å…¥çš„æ–¹å¼ï¼ˆéš¾æ€ªIDEAä¸­ä½¿ç”¨@Autowiredæ³¨è§£çš„æ—¶å€™è€æ˜¯æç¤ºä½¿ç”¨æ„é€ çš„æ–¹å¼ï¼‰ï¼Œæ„é€ æ³¨å…¥æä¾›å·¥å‚æ•°çš„nullæ£€æŸ¥è€Œä¸”ä¼šå°†å‚æ•°ä½œä¸ºä¸€ä¸ªä¸å¯å˜çš„å¯¹è±¡æ¥ä½¿ç”¨ã€‚æ³¨æ„ä¸è¦åœ¨æ„é€ æ–¹æ³•ä¸­ä½¿ç”¨è¿‡å¤šçš„æ„é€ å‚æ•°äº†ï¼Œä¼šäº§ç”Ÿåå‘³é“çš„ã€‚


é¦–å…ˆæ¥çœ‹ä¸€ä¸‹Springæ˜¯å¦‚ä½•æ‰«æç±»çš„å§ã€‚

ä¸€ä¸‹ä»£ç ä½¿ç”¨çš„SpringBoot 2.2ç‰ˆæœ¬

1.æ‰«æbasePackageä¸‹çš„classæ–‡ä»¶ã€‚

2.ç­›é€‰æ˜¯å¦æ ‡è®°ä¸ºComponentçš„ç±»ã€‚

ClassPathScanningCandidateComponentProvider.java
private Set&lt;BeanDefinition&gt; scanCandidateComponents(String basePackage) {
		Set&lt;BeanDefinition&gt; candidates = new LinkedHashSet&lt;&gt;();
		try {
			String packageSearchPath = ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +
					resolveBasePackage(basePackage) + '/' + this.resourcePattern;
                    //é€šè¿‡basePackageè·å–å½“å‰è·¯å¾„ä¸‹çš„classæ–‡ä»¶ä¿¡æ¯
			Resource[] resources = getResourcePatternResolver().getResources(packageSearchPath);
			boolean traceEnabled = logger.isTraceEnabled();
			boolean debugEnabled = logger.isDebugEnabled();
			for (Resource resource : resources) {
				if (traceEnabled) {
					logger.trace("Scanning " + resource);
				}
				if (resource.isReadable()) {
					try {
						MetadataReader metadataReader = getMetadataReaderFactory().getMetadataReader(resource);
                        //ç­›é€‰class
						if (isCandidateComponent(metadataReader)) {
							ScannedGenericBeanDefinition sbd = new ScannedGenericBeanDefinition(metadataReader);
							...
}


PathMatchingResourcePatternResolver.java
Assert.notNull(locationPattern, "Location pattern must not be null");
		if (locationPattern.startsWith(CLASSPATH_ALL_URL_PREFIX)) {
			// a class path resource (multiple resources for same name possible)
			if (getPathMatcher().isPattern(locationPattern.substring(CLASSPATH_ALL_URL_PREFIX.length()))) {
				// a class path resource pattern
				return findPathMatchingResources(locationPattern);
			}
			else {
				// all class path resources with the given name
				return findAllClassPathResources(locationPattern.substring(CLASSPATH_ALL_URL_PREFIX.length()));
			}
		}
		else {
			// Generally only look for a pattern after a prefix here,
			// and on Tomcat only after the "*/" separator for its "war:" protocol.
			int prefixEnd = (locationPattern.startsWith("war:") ? locationPattern.indexOf("*/") + 1 :
					locationPattern.indexOf(':') + 1);
			if (getPathMatcher().isPattern(locationPattern.substring(prefixEnd))) {
				// a file pattern
				return findPathMatchingResources(locationPattern);
			}
			else {
				// a single resource with the given name
				return new Resource[] {getResourceLoader().getResource(locationPattern)};
			}
		}


2.ä»CachingMetadataReaderFactoryè·å–æ‰«æåˆ°çš„ç±»ä¿¡æ¯å¹¶è£…é…æˆä¸€ä¸ªConfigurationï¼ˆè¡¨ç¤ºå®šä¹‰ç±»çš„ä¸€äº›è¡Œä¸ºå’Œä¾èµ–å…³ç³»ï¼‰
protected final void parse(@Nullable String className, String beanName) throws IOException {
		Assert.notNull(className, "No bean class name for configuration class bean definition");
		MetadataReader reader = this.metadataReaderFactory.getMetadataReader(className);
		processConfigurationClass(new ConfigurationClass(reader, beanName));
	}


3.ä¸æ–­å¾—è°ƒç”¨ConfigurationClassParserä¸­doProcessConfigurationClassæ–¹æ³•è§£æå®šä¹‰çš„æ³¨è§£çš„è¡Œä¸ºï¼Œå¹¶æ ¹æ®æ³¨è§£æ‰«æåŠ è½½ç›¸å…³çš„ç±»ï¼ˆæ‰§è¡ŒåŒæ ·çš„æ­¥éª¤ï¼‰
// Recursively process the configuration class and its superclass hierarchy.
		SourceClass sourceClass = asSourceClass(configClass);
		do {
			sourceClass = doProcessConfigurationClass(configClass, sourceClass);
		}
		while (sourceClass != null);


æ‰«æç±»æ­¥éª¤
if (configClass.getMetadata().isAnnotated(Component.class.getName())) {
			// Recursively process any member (nested) classes first
			processMemberClasses(configClass, sourceClass);
}

		// Process any @PropertySource annotations
        ...
        // Process any @ComponentScan annotations
        ...
        // Process any @Import annotations
        ...
        // Process any @ImportResource annotations
        ...
        // Process individual @Bean methods
        ...
        // Process default methods on interfaces
        ...
        // Process superclass, if any
        ...
        // No superclass -&gt; processing is complete


ä»¥ä¸Šæ­¥éª¤å®Œæˆä¹‹åè¿˜æ²¡æœ‰æ­£å¼çš„åˆå§‹åŒ–Bean

4.æŠŠè£…é…å¥½çš„BeanæŒ‰ç…§ä¾èµ–å…³ç³»æ’å¥½åº
sortPostProcessors(currentRegistryProcessors, beanFactory);


5.ä¹‹åä¼šæ‰§è¡Œä¸€äº›ä¸€ç³»åˆ—çš„postProcessæ“ä½œï¼Œå…¶ä¸­ä½¿ç”¨åˆ°äº†CGLIBçš„å­—èŠ‚ç å¢å¼ºå¤„ç†ã€‚
public Class&lt;?&gt; enhance(Class&lt;?&gt; configClass, @Nullable ClassLoader classLoader) {
		if (EnhancedConfiguration.class.isAssignableFrom(configClass)) {
			if (logger.isDebugEnabled()) {
				logger.debug(String.format("Ignoring request to enhance %s as it has " +
						"already been enhanced. This usually indicates that more than one " +
						"ConfigurationClassPostProcessor has been registered (e.g. via " +
						"&lt;context:annotation-config&gt;). This is harmless, but you may " +
						"want check your configuration and remove one CCPP if possible",
						configClass.getName()));
			}
			return configClass;
		}
		Class&lt;?&gt; enhancedClass = createClass(newEnhancer(configClass, classLoader));
		if (logger.isTraceEnabled()) {
			logger.trace(String.format("Successfully enhanced %s; enhanced class name is: %s",
					configClass.getName(), enhancedClass.getName()));
		}
		return enhancedClass;
	}


6.æœ€ååœ¨å‡†å¤‡å·¥ä½œéƒ½å®Œæˆä¹‹åå¼€å§‹åˆå§‹åŒ–éæ‡’åŠ è½½çš„Beanã€‚
// Instantiate all remaining (non-lazy-init) singletons.
beanFactory.preInstantiateSingletons();

BeanFactoryæ˜¯åˆ›å»ºBeançš„ä¸»è¦ç±»å…·ä½“çš„å®ç°æ˜¯åœ¨ AbstractBeanFactoryä¸­çš„ doGetBeanæ–¹æ³•ä¸­

// Trigger initialization of all non-lazy singleton beans...
		for (String beanName : beanNames) {
			RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName);
			if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) {
				if (isFactoryBean(beanName)) {
					Object bean = getBean(FACTORY_BEAN_PREFIX + beanName);
					if (bean instanceof FactoryBean) {
						final FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean;
						boolean isEagerInit;
						if (System.getSecurityManager() != null &amp;&amp; factory instanceof SmartFactoryBean) {
							isEagerInit = AccessController.doPrivileged((PrivilegedAction&lt;Boolean&gt;)
											((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit,
									getAccessControlContext());
						}
						else {
							isEagerInit = (factory instanceof SmartFactoryBean &amp;&amp;
									((SmartFactoryBean&lt;?&gt;) factory).isEagerInit());
						}
						if (isEagerInit) {
							getBean(beanName);
						}
					}
				}
				else {
					getBean(beanName);
				}
			}
		}


å…·ä½“å®ä¾‹åŒ–çš„æ—¶å€™ä¼šæœ‰ä¸åŒçš„InstanceStrategyï¼Œå¦‚æœæ˜¯ä½¿ç”¨é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼ˆå°±æ˜¯æ²¡æœ‰æ³¨è§£æ ‡è®°çš„ï¼‰å°±ä¼šä½¿ç”¨ SimpleInstantiationStrategy åå°„é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œå¦‚æœæ˜¯ä½¿ç”¨äº†æ³¨è§£ï¼Œå°±ä¼šä½¿ç”¨ CglibSubclassingInstantiationStrategy ç”Ÿäº§ä»£ç†ç±»ã€‚

7.æœ€åé€šçŸ¥å®¹å™¨Beanåˆ›å»ºå®Œæˆã€‚

Consolation

ä»¥ä¸Šå°±æ˜¯Springåˆ›å»ºBeançš„ä¸€ä¸ªå¤§æ¦‚æµç¨‹ã€‚ç”±äºæºç å¤šè€Œæ‚å¾ˆå¤šç»†èŠ‚çš„åœ°æ–¹éƒ½æ²¡æœ‰ä»”ç»†å»çœ‹ï¼Œæœ¬æ¬¡ä¸»è¦æ˜¯æƒ³çŸ¥é“Springæ˜¯åˆ›å»ºBeançš„ä¸€ä¸ªæµç¨‹ï¼Œä»æ‰«æç±»åˆ°è§£æç±»çš„ä¿¡æ¯ï¼Œå†åˆ°å°†ç±»ä¿¡æ¯è½¬åŒ–å¯è§£é‡Šçš„é…ç½®ç±»ï¼Œå†ç»Ÿä¸€å°†é…ç½®ç±»æŒ‰ç…§ä¸åŒçš„å®ä¾‹åŒ–ç­–ç•¥è¿›è¡Œå®ä¾‹åŒ–ï¼Œå†åˆ°å®ä¾‹åŒ–ä¹‹åçš„åå¤„ç†æ“ä½œã€‚æ•´ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å…·ä½“å®ç°èµ·æ¥å°±æœ‰å¾ˆå¤šçš„ç»†èŠ‚é—®é¢˜éœ€è¦è€ƒè™‘å‘¨å…¨ï¼Œæ¯”å¦‚å…¶ä¸­ä¸ºäº†åŠ å¿«ç±»çš„è§£æè¿‡ç¨‹ï¼Œä½¿ç”¨äº†ç¼“å­˜ã€‚åˆæ¯”å¦‚ä½¿ç”¨äº†CGLIBæ¥åŠ¨æ€ä»£ç†æ¥å®ç°æ–¹æ³•æ³¨å…¥ã€‚å¾ªç¯ä¾èµ–çš„æ£€æµ‹ä¸å¤„ç†ï¼Œä»¥åŠå¤§é‡çš„åå°„æŠ€æœ¯ã€‚å†…å®¹å¤ªå¤šäº†ï¼Œæƒ³è¦äº†è§£çš„é€å½»è¿˜å¾—åŒ–å¾ˆå¤šæ—¶é—´å»çœ‹æºç ã€‚

è¯´äº†é‚£ä¹ˆå¤šæœ€ç»ˆçš„æ”¶è·åœ¨äºäº†è§£äº†DIæŠ€æœ¯åˆ©å¼Šï¼Œå­¦äº†DIçš„ç¼–ç¨‹æ€æƒ³ã€‚è¿™ç§DIæŠ€å·§å¹¶ä¸æ€»æ˜¯åœ¨Javaä¸­æ‰èƒ½å®ç°çš„ï¼Œè€Œæ˜¯æ¯ä¸€ç§ç¼–ç¨‹è¯­è¨€éƒ½æœ‰ã€‚å¹¶ä¸æ˜¯ä¸Javaçš„æ³¨è§£ç»‘å®šçš„ï¼Œæ³¨è§£åªæ˜¯ç®€åŒ–äº†ä»£ç å’Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€‚å…¶å®æˆ‘ç†è§£çš„DIæœ€ä¸»è¦çš„æ€æƒ³å°±æ˜¯è®©è°ƒç”¨æ–¹ä¸å…³å¿ƒä¾èµ–ç±»çš„åˆ›å»ºé€»è¾‘å’Œå…·ä½“å®ç°ï¼Œè°ƒç”¨æ–¹é€šè¿‡ç»„è£…éœ€è¦çš„ä¾èµ–ç±»æ¥å®ç°è‡ªå·±æƒ³è¦å®ç°çš„é€»è¾‘ã€‚æ˜¯ä¸€ä¸ªé«˜å±‚ä¾èµ–åº•å±‚çš„ä¸€ç§å…³ç³»ã€‚è¿™ç§ç»“æ„è®©å¤§å‹å¤šå±‚åº”ç”¨èƒ½å¤Ÿæœ‰æ•ˆçš„ç»´æŠ¤å’Œå¼€å‘ï¼Œé¿å…äº†ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«çš„å½±å“ã€‚

ååºé˜…è¯»æ›´æ–°ï¼ˆ2019-12-25ï¼‰

The Spring container validates the configuration of each bean as the container is created. However, the bean properties themselves are not set until the bean is actually created. Beans that are singleton-scoped and set to be pre-instantiated (the default) are created when the container is created. Scopes are defined in Bean Scopes. Otherwise, the bean is created only when it is requested. Creation of a bean potentially causes a graph of beans to be created, as the beanâ€™s dependencies and its dependencies' dependencies (and so on) are created and assigned. Note that resolution mismatches among those dependencies may show up lateâ€‰â€”â€‰that is, on first creation of the affected bean.
//è°·æ­Œç¿»è¯‘
åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼ŒSpringå®¹å™¨ä¼šéªŒè¯æ¯ä¸ªbeançš„é…ç½®ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…åˆ›å»ºBeanä¹‹å‰ï¼Œä¸ä¼šè®¾ç½®Beanå±æ€§æœ¬èº«ã€‚åˆ›å»ºå®¹å™¨æ—¶ï¼Œå°†åˆ›å»ºå…·æœ‰å•ä¾‹ä½œç”¨åŸŸå¹¶è®¾ç½®ä¸ºé¢„å…ˆå®ä¾‹åŒ–ï¼ˆé»˜è®¤ï¼‰çš„Beanã€‚èŒƒå›´åœ¨BeanèŒƒå›´ä¸­å®šä¹‰ã€‚å¦åˆ™ï¼Œä»…åœ¨è¯·æ±‚æ—¶æ‰åˆ›å»ºBeanã€‚åˆ›å»ºå’Œåˆ†é…beançš„ä¾èµ–å…³ç³»åŠå…¶ä¾èµ–å…³ç³»ï¼ˆä¾æ­¤ç±»æ¨ï¼‰æ—¶ï¼Œåˆ›å»ºbeanå¯èƒ½ä¼šå¯¼è‡´åˆ›å»ºä¸€ä¸ªbeanå›¾ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›ä¾èµ–é¡¹ä¹‹é—´çš„åˆ†è¾¨ç‡ä¸åŒ¹é…å¯èƒ½ä¼šæ˜¾ç¤ºå¾—è¾ƒæ™š-å³åœ¨é¦–æ¬¡åˆ›å»ºå—å½±å“çš„beanæ—¶ã€‚


Reference


  The IoC Container

</p>
  
  <h2><a href="/2019/10/13/About-OAuth2.html">About OAuth2 </a></h2>
  <small>October 13, 2019</small>
  <p>Background

Recently,out team have to divided original system to two microservice system. letâ€™s call they system A and system B.My goal is to implement a Authorization Server and Single-Sign-On. So i decided to use Spring security framework to do this.Itâ€™s not easy as i think,i got lots of problems.Finally i made it,and i want to recored this to review.

What is OAuth 2.0

OAuth is not an API or a service: itâ€™s an open standard for authorization and anyone can implement it.OAuth 2.0 is widely used by applications.For example,a app need access your wechat contacts list,so the app need authorized by wechat,you have probably used OAuth 2.0.

OAuth 2.0 includes four roles:


  Resource owner (userâ€™s private resources such as profile,photos etc)
  Client (the app want to access userâ€™s resources)
  Resource server (stores userâ€™s private resources and shares them with authorized clients)
  Authorization Server (used for certification)


OAuth 2.0 support four grant types to obtain the resource ownerâ€™s permission(called access_token)

  Password Credentials
  Client Credentials
  Authorization Code
  Implicit


Password Credentials usually used for trusted clients

  used by first-party clients to exchange a userâ€™s credentials for an access token.


Client Credentials used to access resources owned by the client itself

  typically used by clients to access resources about themselves rather than to access a userâ€™s resources.


Above two grant types will revealed resource ownerâ€™s credentials to third-part

Authorization Code the most complicate flow in OAuth 2.0

  used by confidential and public clients to exchange an authorization code for an access token.After the user returns to the client via the redirect URL, the application will get the authorization code from the URL and use it to request an access token.


Implicit generally not recommended to use the implicit flow

  a simplified flow that can be used by public clients, where the access token is returned immediately without an extra authorization code exchange step.


Above two grant type are more interesting as they are used by public clients and users give their permission to third party applications

In my practice,i only used Authorization Code and Password grant types , finally choose the Password grant type because own system A and system B is trusted clients.

Why using OAuth 2.0

Actually,iâ€™m not sure why i have to using the OAuth 2.0.I just Google the Spring security want to make a Single-Sign-On system, and then the google search resutls show me lots of anwsers like : Spring Security SSO With OAuth 2.0 as far now i just know OAuth 2.0 is a protocolOAuth 2.0 is not an authentication protocol i have to use it if i using the Spring Security framework.So iâ€™m thinking Why using OAuth 2.0? and Why OAuth 2.0 is safe?

i found a simple anwser of the What goal of the OAuth 2.0? on offical site.


  OAuth 2.0 focuses on client developer simplicity while providing specific authorization flows for web applications, desktop applications, mobile phones, and living room devices.


Simplicity is one of the keypoint for why using OAuth 2.0,becasue OAuth 1.0 implementation attempts are caused by the complexity of the cryptographic requirements of the specification.Anothrer reason is OAuth 2.0 support support for non-browser based applications.

OAuth 2.0 Access tokens are â€œshort-livedâ€ which means OAuth 2.0 is more safe than OAuth 2.0 , when access_token is expired you need refresh_token to get a new access_token.You should notice that access token canâ€™t be revoked you just have to wait for them to time out.

Not interact with user credentials no need userâ€™s username or password for access_token instead using authoirzation code exchange for access_token.

Keep userâ€™s infomation in token It accesses the data using tokens instead of using their credentials and stores data in online file system of the user such as Google Docs or Dropbox account.

Conclusion

Actually,OAuth 2.0 purpose is to â€œHow can I allow an app to access my data without necessarily giving it my password?â€ , and support non-browser based applications.OAuth 2.0 security depends on how you implement system is.

Reference


  Official Site
  Introducing OAuth 2.0
  What the Heck is OAuth?
  How is OAuth 2 different from OAuth 1?

</p>
  
  <h2><a href="/2019/09/17/Quarkus-Hot-Reload-With-IDEA.html">Quarkus Hot Reload With IDEA </a></h2>
  <small>September 17, 2019</small>
  <p>Quarkus


  A Kubernetes Native Java stack tailored for GraalVM &amp; OpenJDK HotSpot, crafted from the best of breed Java libraries and standards


For me ? quarkus is a standard  framework,it combine lots of useful web framework.And it provides amazing boot time and optimizes developer joy.Also it can compile to native app and support hot reload.YES,hot reload with IDEA is really awsome!when i found i can use IDEA deloyment Tools automatic upload file to a server machine and it will automic reload the server.Just like below picture say ğŸ‘‡:



It sounds easy but things not going well ğŸ˜Ÿ.

First try

I configuraed the IDEA delopyment tool and upload the exmpale project to server machine.



execute cmd to start up :

  ./mvnw compile quarkus:dev


And everythins same to be fine :



But no matter how i modify the ExampleResource.java,it didnâ€™t touch the hot reload.The ExampleResource.java did upload to the server machine.Why quarkus server not hot reload? So i using vim modify the ExampleResource.java on server machine,quarkus did hot reload.This is really confuse me.Iâ€™m wandering howâ€™s the quarkus hot reload works ? Maybe i can found why IDEA automatic upload not trigger the hot reload.

Second Try

I notice that when i modify a file and only when i vistied the resource path on borwer quarkus would do hot reload.So i debug on the IDEA and watching what happend.

First i found the restart code (DevModMain.java) on github:

public synchronized void restartApp(Set&lt;String&gt; changedResources) {
        stop();
        Timing.restart();
        doStart(true, changedResources);
    }


And keep digging :

RuntimeUpdatesProcessor.java
@Override
    public boolean doScan(boolean userInitiated) throws IOException {
        final long startNanoseconds = System.nanoTime();
        for (Runnable step : preScanSteps) {
            try {
                step.run();
            } catch (Throwable t) {
                log.error("Pre Scan step failed", t);
            }
        }
        //This is key point 
        boolean classChanged = checkForChangedClasses();
        Set&lt;String&gt; filesChanged = checkForFileChange();

       ...
    }


Finally i found key method on checkForChangedClasses().

RuntimeUpdatesProcessor.java

 boolean checkForChangedClasses() throws IOException {
        boolean hasChanges = false;
        for (DevModeContext.ModuleInfo module : context.getModules()) {
            final List&lt;Path&gt; moduleChangedSourceFilePaths = new ArrayList&lt;&gt;();
            for (String sourcePath : module.getSourcePaths()) {
                final Set&lt;File&gt; changedSourceFiles;
                try (final Stream&lt;Path&gt; sourcesStream = Files.walk(Paths.get(sourcePath))) {
                    changedSourceFiles = sourcesStream
                            .parallel()
                            .filter(p -&gt; matchingHandledExtension(p).isPresent() &amp;&amp; wasRecentlyModified(p))
                            .map(Path::toFile)
                            //Needing a concurrent Set, not many standard options:
                            .collect(Collectors.toCollection(ConcurrentSkipListSet::new));
                }
                ...
    }


wasRecentlyModified(p)
    private boolean wasRecentlyModified(final Path p) {
        try {
            long sourceMod = Files.getLastModifiedTime(p).toMillis();
            return sourceMod &gt; lastChange;
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }


quarkus hot reload depends on compare file last modified time with system last change time. the whole process is : when i send http request,quarkus will handle the request and check the resource file whether to modify and do hot reload.

So i change the IDEA config like this :



Enjoying Coding with quarkus ğŸ‘!
</p>
  
</div>



<!-- pagination -->

<div class="pagination">
  
  <span>&laquo; Prev</span>
  

  
  
  <span class="webjeda">1</span>
  
  
  
  <a href="/page2">2</a>
  
  

  
  <a href="/page2">Next &raquo;</a>
  
</div>

            </article>
        </main>

        <footer>
            <p class="copy">
                <small>Copyrights by
                    Joe
                    | Developed by
                    <a href="http://webjeda.com">webjeda</a>
                </small>
            </p>
        </footer>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-157580785-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-157580785-1');
</script>
    </body>

</html>
